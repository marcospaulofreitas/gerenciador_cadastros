<div class="main-container">
  <div class="app-title">
    <h1>TechControl</h1>
    <div class="subtitle">Sistema de Gerenciamento de Revendas e T√©cnicos</div>
  </div>
  
  <div class="access-windows">
    <div class="access-window" data-bs-toggle="modal" data-bs-target="#revendaModal">
      <div class="access-icon">üè™</div>
      <p class="access-text">Revenda</p>
      <div class="access-button revenda">
        Acessar como Revenda
      </div>
    </div>
    
    <div class="access-window" data-bs-toggle="modal" data-bs-target="#webpostoModal">
      <div class="access-icon">üñ•Ô∏è</div>
      <p class="access-text">WebPosto</p>
      <div class="access-button webposto">
        Acessar como WebPosto
      </div>
    </div>
  </div>
</div>

<!-- Modal para CNPJ da Revenda -->
<div class="modal fade" id="revendaModal" tabindex="-1" data-bs-backdrop="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border: none; border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
      <div class="modal-body p-4">
        <button type="button" class="btn btn-back float-start mb-3" data-bs-dismiss="modal">
          ‚Üê Voltar
        </button>
        <div class="clearfix"></div>
        <div class="text-center mb-4">
          <h5>Acesso Revenda</h5>
        </div>
        
        <%= form_with url: validate_cnpj_path, method: :post, local: false, id: "cnpj-form" do |f| %>
          <div class="mb-3">
            <%= f.label :cnpj, "CNPJ da Revenda", class: "form-label text-start d-block" %>
            <%= f.text_field :cnpj, class: "form-control", placeholder: "00.000.000/0000-00", required: true, maxlength: "18", id: "cnpj-input" %>
          </div>
          <div id="cnpj-error" class="alert alert-danger d-none"></div>
          <button type="submit" class="btn btn-primary w-100">Validar</button>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Login WebPosto -->
<div class="modal fade" id="webpostoModal" tabindex="-1" data-bs-backdrop="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border: none; border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
      <div class="modal-body p-4">
        <button type="button" class="btn btn-back float-start mb-3" data-bs-dismiss="modal">
          ‚Üê Voltar
        </button>
        <div class="clearfix"></div>
        <div class="text-center mb-4">
          <h5>Acesso WebPosto</h5>
        </div>
        
        <%= form_with model: User.new, url: user_session_path, local: true do |f| %>
          <div class="mb-3">
            <%= f.label :email, "E-mail", class: "form-label text-start d-block" %>
            <%= f.email_field :email, autofocus: true, autocomplete: "email", class: "form-control", placeholder: "seu@email.com" %>
          </div>

          <div class="mb-3">
            <%= f.label :password, "Senha", class: "form-label text-start d-block" %>
            <%= f.password_field :password, autocomplete: "current-password", class: "form-control", placeholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" %>
          </div>

          <div class="mb-3 form-check">
            <%= f.check_box :remember_me, class: "form-check-input" %>
            <%= f.label :remember_me, "Lembrar-me", class: "form-check-label" %>
          </div>

          <button type="submit" class="btn btn-primary w-100">Entrar</button>
        <% end %>

        <div class="text-center mt-3">
          <%= link_to "Esqueci a senha", new_user_password_path, class: "forgot-password" %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// M√°scara para CNPJ
document.getElementById('cnpj-input').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  value = value.replace(/(\d{2})(\d)/, '$1.$2');
  value = value.replace(/(\d{3})(\d)/, '$1.$2');
  value = value.replace(/(\d{3})(\d)/, '$1/$2');
  value = value.replace(/(\d{4})(\d)/, '$1-$2');
  e.target.value = value;
});

// Limpar campos ao fechar modais
document.getElementById('revendaModal').addEventListener('hidden.bs.modal', function() {
  document.getElementById('cnpj-input').value = '';
  document.getElementById('cnpj-error').classList.add('d-none');
});

document.getElementById('webpostoModal').addEventListener('hidden.bs.modal', function() {
  const form = document.querySelector('#webpostoModal form');
  if (form) {
    form.reset();
  }
});

// Submit do formul√°rio
document.getElementById('cnpj-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const formData = new FormData(this);
  const errorDiv = document.getElementById('cnpj-error');
  
  fetch('<%= validate_cnpj_path %>', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      window.location.href = data.redirect_url;
    } else {
      errorDiv.textContent = data.error;
      errorDiv.classList.remove('d-none');
    }
  })
  .catch(error => {
    errorDiv.textContent = 'Erro ao validar CNPJ';
    errorDiv.classList.remove('d-none');
  });
});
</script>
<div class="text-center">
  <h1 class="mb-5">Gerenciador de Cadastros</h1>
  
  <div class="home-buttons">
    <button type="button" class="btn btn-primary home-button" data-bs-toggle="modal" data-bs-target="#revendaModal">
      <i class="fas fa-store mb-2"></i><br>
      Revenda
    </button>
    
    <%= link_to webposto_login_path, class: "btn btn-success home-button" do %>
      <i class="fas fa-desktop mb-2"></i><br>
      WebPosto
    <% end %>
  </div>
</div>

<!-- Modal para CNPJ da Revenda -->
<div class="modal fade" id="revendaModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Acesso Revenda</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <%= form_with url: validate_cnpj_path, method: :post, local: false, id: "cnpj-form" do |f| %>
          <div class="mb-3">
            <%= f.label :cnpj, "CNPJ da Revenda", class: "form-label" %>
            <%= f.text_field :cnpj, class: "form-control", placeholder: "00.000.000/0000-00", required: true %>
          </div>
          <div id="cnpj-error" class="alert alert-danger d-none"></div>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" form="cnpj-form" class="btn btn-primary">Validar CNPJ</button>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('cnpj-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const formData = new FormData(this);
  const errorDiv = document.getElementById('cnpj-error');
  
  fetch('<%= validate_cnpj_path %>', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      window.location.href = data.redirect_url;
    } else {
      errorDiv.textContent = data.error;
      errorDiv.classList.remove('d-none');
    }
  })
  .catch(error => {
    errorDiv.textContent = 'Erro ao validar CNPJ';
    errorDiv.classList.remove('d-none');
  });
});
</script>